[bits 32]
global _hlt
global _cli
global _sti
global _io_out8
global _io_out16
global _io_out32
global _io_in8
global _io_in16
global _io_in32
global _load_gdt
global _load_idt
global _WORDS
global _asm_inthandler21h
global _asm_inthandler27h
global _asm_inthandler2ch
global _stihlt
extern _inthandler21h
extern _inthandler27h
extern _inthandler2ch
[segment .text]

_hlt: ; void hlt()
	hlt
	ret

_cli: ; void cli()
	cli
	ret

_sti: ;void sti()
	sti
	ret
_stihlt: ;void stihlt()
	sti
	hlt
	ret
_io_out8: ; void io_out8(int port, int data)
	mov edx,[esp+4]
	mov eax,[esp+8]
	out dx,al
	ret

_io_out16: ; void io_out16(int port, int data)
	mov edx,[esp+4]
	mov eax,[esp+8]
	out dx,ax
	ret

_io_out32: ; void io_out32(int port, int data)
	mov edx,[esp+4]
	mov eax,[esp+8]
	out dx,eax
	ret

_io_in8: ; unsigned char io_in8(int port)
	mov edx,[esp+4]
	mov eax,0
	in al,dx
	ret

_io_in16: ; unsigned short io_in16(int port)
	mov edx,[esp+4]
	mov eax,0
	in ax,dx
	ret

_io_in32: ; unsigned int io_in32(int port)
	mov edx,[esp+4]
	in eax,dx
	ret
_load_gdt:; void load_gdt(int limit,int addr)
	mov ax,[esp+4]
	mov [esp+6],ax
	lgdt [esp+6]
	ret
_load_idt:; void load_idt(int limit,int addr)
	mov ax,[esp+4]
	mov [esp+6],ax
	lidt [esp+6]
	ret
_asm_inthandler21h: ;void asm_inthandler21h()
	push es
	push ds
	pushad
	mov eax,esp
	push eax
	mov ax,ss
	mov ds,ax
	mov es,ax
	call _inthandler21h
	pop eax
	popad
	pop ds
	pop es
	iretd
_asm_inthandler27h:;void asm_inthandler27h()
	push es
	push ds
	pushad
	mov eax,esp
	push eax
	mov ax,ss
	mov ds,ax
	mov es,ax
	call _inthandler27h
	pop eax
	popad
	pop ds
	pop es
	iretd
_asm_inthandler2ch:;void asm_inthandler2ch()
	push es
	push ds
	pushad
	mov eax,esp
	push eax
	mov ax,ss
	mov ds,ax
	mov es,ax
	call _inthandler2ch
	pop eax
	popad
	pop ds
	pop es
	iretd

	
_WORDS: ;0x00-0x7f 128words 
	DB 0x70,0x88,0x88,0x88,0x70,0x00,0x00,0x00 ;加载/等待指针（圆圈）
	DB 0xF8,0xE0,0xC0,0x98,0x98,0x00,0x00,0x00 ;箭头指针（三角）
	TIMES 14*8 DB 0
	TIMES 16*8 DB 0
	DB 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00 ;space
	DB 0x18,0x24,0x24,0x42,0x7E,0x42,0x42,0x42 ;!
	DB 0x28,0x28,0x00,0x00,0x00,0x00,0x00,0x00 ;"
	DB 0x00,0x12,0x7F,0x24,0x24,0xFE,0x48,0x00 ;#
	DB 0x10,0x38,0x54,0x70,0x1C,0x54,0x38,0x10 ;$
	DB 0xC2,0xC6,0x0C,0x18,0x30,0x63,0xC3,0x80 ;%
	DB 0x18,0x24,0x24,0x38,0x52,0x4C,0x3A,0x00 ;&
	DB 0x04,0x04,0x08,0x00,0x00,0x00,0x00,0x00 ;'
	DB 0x00,0x10,0x20,0x40,0x40,0x40,0x20,0x10 ;(
	DB 0x00,0x20,0x10,0x08,0x08,0x08,0x10,0x20 ;)
	DB 0x00,0x10,0x54,0x38,0x10,0x38,0x54,0x10 ;*
	DB 0x00,0x00,0x10,0x10,0x7C,0x10,0x10,0x00 ;+
	DB 0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x20 ;,
	DB 0x00,0x00,0x00,0x00,0x7C,0x00,0x00,0x00 ;-
	DB 0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30 ;.
	DB 0x00,0x08,0x08,0x10,0x10,0x20,0x20,0x40 ;/

	DB 0x00,0x38,0x44,0x44,0x54,0x44,0x44,0x38 ;0
	DB 0x00,0x18,0x28,0x08,0x08,0x08,0x08,0x3C ;1
	DB 0x00,0x38,0x44,0x04,0x08,0x10,0x20,0x7C ;2
	DB 0x00,0x38,0x44,0x04,0x38,0x04,0x44,0x38 ;3
	DB 0x00,0x08,0x10,0x28,0x48,0x7C,0x08,0x08 ;4
	DB 0x00,0x3C,0x20,0x20,0x3C,0x02,0x22,0x1C ;5
	DB 0x00,0x1C,0x20,0x20,0x3C,0x22,0x22,0x1C ;6
	DB 0x00,0x38,0x04,0x08,0x08,0x10,0x10,0x10 ;7
	DB 0x00,0x18,0x24,0x24,0x18,0x24,0x24,0x18 ;8
	DB 0x00,0x18,0x24,0x24,0x1C,0x04,0x24,0x18 ;9
	DB 0x00,0x00,0x30,0x30,0x00,0x30,0x30,0x00 ;:
	DB 0x00,0x00,0x00,0x30,0x00,0x10,0x10,0x20 ;;
	DB 0x00,0x00,0x08,0x10,0x20,0x10,0x08,0x00 ;<
	DB 0x00,0x00,0x00,0x3C,0x00,0x3C,0x00,0x00 ;=
	DB 0x00,0x00,0x20,0x10,0x08,0x10,0x20,0x00 ;>
	DB 0x38,0x44,0x44,0x08,0x10,0x10,0x00,0x10 ;?

	DB 0x7E,0x81,0x99,0xA5,0xA5,0xBA,0x80,0x7E ;@
	DB 0x00,0x18,0x24,0x24,0x42,0x7E,0x42,0x42 ;A
	DB 0x00,0x78,0x44,0x44,0x78,0x44,0x44,0x78 ;B
	DB 0x00,0x38,0x44,0x40,0x40,0x40,0x44,0x38 ;C
	DB 0x00,0x78,0x44,0x42,0x42,0x42,0x44,0x78 ;D
	DB 0x00,0x7C,0x40,0x40,0x7C,0x40,0x40,0x7C ;E
	DB 0x00,0x7C,0x40,0x40,0x7C,0x40,0x40,0x40 ;F
	DB 0x00,0x38,0x44,0x40,0x40,0x4C,0x44,0x3C ;G
	DB 0x00,0x44,0x44,0x44,0x7C,0x44,0x44,0x44 ;H
	DB 0x00,0x7C,0x10,0x10,0x10,0x10,0x10,0x7C ;I
	DB 0x00,0x3C,0x08,0x08,0x08,0x08,0x48,0x30 ;J
	DB 0x00,0x4C,0x50,0x60,0x60,0x50,0x48,0x44 ;K
	DB 0x00,0x40,0x40,0x40,0x40,0x40,0x40,0x7C ;L
	DB 0x00,0x44,0x6C,0x54,0x44,0x44,0x44,0x44 ;M
	DB 0x00,0x42,0x62,0x52,0x4A,0x46,0x42,0x42 ;N
	DB 0x00,0x3C,0x42,0x42,0x42,0x42,0x42,0x3C ;O

	DB 0x00,0x78,0x44,0x44,0x78,0x40,0x40,0x40 ;P
	DB 0x00,0x38,0x44,0x44,0x44,0x54,0x4C,0x3A ;Q
	DB 0x00,0x78,0x44,0x44,0x78,0x50,0x48,0x44 ;R
	DB 0x00,0x38,0x44,0x40,0x38,0x04,0x44,0x38 ;S
	DB 0x00,0x7C,0x10,0x10,0x10,0x10,0x10,0x10 ;T
	DB 0x00,0x44,0x44,0x44,0x44,0x44,0x44,0x38 ;U
	DB 0x00,0x44,0x44,0x44,0x44,0x28,0x28,0x10 ;V
	DB 0x00,0x44,0x44,0x54,0x54,0x54,0x28,0x28 ;W
	DB 0x00,0x44,0x44,0x28,0x10,0x28,0x44,0x44 ;X
	DB 0x00,0x44,0x44,0x28,0x10,0x10,0x10,0x10 ;Y
	DB 0x00,0x7C,0x04,0x08,0x10,0x20,0x40,0x7C ;Z
	DB 0x00,0x70,0x40,0x40,0x40,0x40,0x40,0x70 ;[
	DB 0x00,0x40,0x40,0x20,0x20,0x10,0x10,0x08 ;反斜杠
	DB 0x00,0x1C,0x04,0x04,0x04,0x04,0x04,0x1C ;]
	DB 0x10,0x28,0x44,0x00,0x00,0x00,0x00,0x00 ;^
	DB 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C ;_

	DB 0x20,0x40,0x40,0x00,0x00,0x00,0x00,0x00 ;’
	DB 0x00,0x00,0x00,0x30,0x48,0x38,0x48,0x3C ;a
	DB 0x00,0x40,0x40,0x40,0x58,0x64,0x44,0x78 ;b
	DB 0x00,0x00,0x00,0x38,0x40,0x40,0x44,0x38 ;c
	DB 0x00,0x04,0x04,0x04,0x34,0x4C,0x44,0x3C ;d
	DB 0x00,0x00,0x00,0x38,0x44,0x7C,0x40,0x3C ;e
	DB 0x00,0x18,0x24,0x20,0x7C,0x20,0x20,0x20 ;f
	DB 0x08,0x30,0x48,0x30,0x40,0x38,0x44,0x38 ;g
	DB 0x00,0x40,0x40,0x40,0x50,0x68,0x48,0x48 ;h
	DB 0x00,0x10,0x00,0x30,0x10,0x10,0x10,0x38 ;i
	DB 0x00,0x08,0x00,0x18,0x08,0x08,0x28,0x10 ;j
	DB 0x00,0x40,0x40,0x40,0x58,0x60,0x50,0x48 ;k
	DB 0x00,0x20,0x20,0x20,0x20,0x20,0x20,0x20 ;l
	DB 0x00,0x00,0x00,0x00,0x28,0x54,0x54,0x54 ;m
	DB 0x00,0x00,0x00,0x00,0x30,0x48,0x48,0x48 ;n
	DB 0x00,0x00,0x00,0x38,0x44,0x44,0x44,0x38 ;o

	DB 0x00,0x00,0x00,0x70,0x48,0x70,0x40,0x40 ;p
	DB 0x00,0x00,0x00,0x1C,0x24,0x1C,0x04,0x04 ;q
	DB 0x00,0x00,0x00,0x28,0x34,0x20,0x20,0x20 ;r
	DB 0x00,0x00,0x00,0x3C,0x40,0x38,0x04,0x78 ;s
	DB 0x00,0x20,0x20,0x7C,0x20,0x20,0x24,0x18 ;t
	DB 0x00,0x00,0x00,0x48,0x48,0x48,0x48,0x34 ;u
	DB 0x00,0x00,0x00,0x44,0x44,0x44,0x28,0x10 ;v
	DB 0x00,0x00,0x00,0x44,0x54,0x54,0x38,0x28 ;w
	DB 0x00,0x00,0x00,0x44,0x28,0x10,0x28,0x44 ;x
	DB 0x00,0x00,0x00,0x48,0x48,0x38,0x08,0x70 ;y
	DB 0x00,0x00,0x00,0x3C,0x48,0x10,0x24,0x78 ;z
	DB 0x00,0x10,0x20,0x20,0x40,0x20,0x20,0x10 ;{
	DB 0x00,0x00,0x20,0x20,0x00,0x20,0x20,0x00 ;|
	DB 0x00,0x08,0x04,0x04,0x02,0x04,0x04,0x08 ;}
	DB 0x00,0x00,0x60,0x92,0x92,0x0C,0x00,0x00 ;~
	DB 0x00,0x00,0x10,0x28,0x44,0x7C,0x00,0x00 ;△

	


